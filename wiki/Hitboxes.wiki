#summary Instructions and index page for hitbox Lua scripts

<wiki:toc max_depth="2" />

----
= Introduction =

Although the sprites on screen seem to interact with one another, 2D fighting games and other action games usually use unseen hitboxes to determine whether attacks connect or miss. These boxes can be made visible in MAME-rr and [http://code.google.com/p/fbarr/ FBA-rr] through the use of [LuaScriptingFunctions Lua scripting]. This information can help players improve their game and help people who don't play the games to appreciate how they work.

Also see [http://combovid.com/?category_name=technical combovid] for in-depth discussions.

== Common box types ==

Some game engines have specialized kinds of boxes, but here are the types that are found in most games.

=== Vulnerability and Attack ===
The attack box must touch the opponent's vulnerability for the attack to connect. Characters may have one or several vulnerability boxes for different areas of the sprite, but most fighting games only allow attacks to have one attack box at a time.

=== Projectile Vulnerability and Attack ===
If an opposing projectile's attack touches a projectile vulnerability box, the projectiles negate one another. In some games, projectiles don't have designated vulnerability areas and negate by touching attack boxes. Non-character objects in the beat-'em-ups are colored as projectiles.

=== Push ===
A pushbox cannot occupy the same space as another pushbox. Attempting to press them together will cause characters to push one another. Jumping attacks that extend below and behind the pushbox allow for easier crossup attacks. Some moves cause pushboxes to disappear, allowing the character to pass through the opponent. In primitive games like Fatal Fury 1 & 2, vulnerability boxes also perform the function of pushboxes. Pushboxes are not used in beat-'em-ups.

=== Throw and Throwable ===
A throwbox must touch the opponent's throwable box for the throw attempt to succeed. Throws are generally active for only one frame. Some games don't have designated throwable boxes and reuse the pushbox for this purpose.

----
= Usage =

These scripts work with either parent and clone ROMs, and with both emulators, but MAME-rr is recommended because of crashing and slowdowns in FBA-rr. Download the script file, load the appropriate ROM, launch a Lua window (ctrl-L by default), then browse for and run the .lua file. The ROM must be up to date for MAME-rr or FBA-rr, and may be out of date with respect to [http://mamedev.org/ mainline MAME].

*The current versions can be downloaded from the [http://mame-rr.googlecode.com/svn/lua/ SVN repository].* Changes are trackable on the [http://code.google.com/p/mame-rr/updates/list update page] or by subscribing to the update feed.

The behavior can be modified by pressing Lua hotkeys. (The key bindings are assigned in the emulator settings.)
 # Hide or reveal all the graphics on the screen to show only the boxes.
 # Hide or reveal axis markers for characters and other objects.
 # Hide or reveal the centers of individual boxes.
 # Hide or reveal pushboxes.
 # Hide or reveal throwability boxes.

The best way to get images is with the emulator's screenshot function (F12 by default).

----
== Background removal ==

The game backgrounds can make the boxes harder to see. This can be offset by increasing the fill opacity of the boxes, but this in turn makes the character sprites harder to see. The ideal solution is to remove the backgrounds entirely. One way to do this is with "cheat" codes that prevent the background and HUD from being displayed by the game.

[http://img84.imageshack.us/img84/3733/ssf2twithbg.png]
[http://img508.imageshack.us/img508/8744/ssf2tblackbg.png]

Codes covering all the currently hitboxed fighting games can be found [https://spreadsheets.google.com/spreadsheet/ccc?key=0Ass5iE_E05JhdC1EMkJiNVBhdllwN0FpWVgzTEQ4T3c here].

Here is how to get them working in MAME: 
 # Download the [http://www.mamecheat.co.uk/ latest official cheat pack].
 # Extract cheat.zip from the downloaded archive to the base MAME folder.
 # Extract the .xml for the appropriate game from cheat.zip to MAME's _cheats_ folder.
 # Open the .xml in a text editor and paste in the code.
 # Run the ROM in MAME, find _Cheats_ from the main menu, and set the code to _On_. If the ROM is already running, select _Reload All_ from the menu to get the code to appear.

Other information:
 * The codes for some games need to be activated before the start of the match to remove the HUD.
 * The codes are designed to only affect the game while a match is in progress.
 * The effects of some codes are not fully reversible.
 * Most of the codes patch ROM data and will only work with parent sets, not clones.
 * The background color for !NeoGeo games can easily be adjusted by editing the color value in the codes.

Screenshots or videos captured with the backgrounds removed can easily be processed to make the background color transparent. In order for this to work with hitboxes, the fill opacity must be set to zero and the border opacity should be maximum.

[http://img703.imageshack.us/img703/2167/ssf2tnobg.png]

----
== Color customization ==

Colors can be changed by editing the `box` values at the top of the scripts.
{{{
	      ["vulnerability"] = {color = 0x7777FF, fill = 0x40, outline = 0xFF},
	             ["attack"] = {color = 0xFF0000, fill = 0x40, outline = 0xFF},
	["proj. vulnerability"] = {color = 0x00FFFF, fill = 0x40, outline = 0xFF},
	       ["proj. attack"] = {color = 0xFF66FF, fill = 0x40, outline = 0xFF},
	               ["push"] = {color = 0x00FF00, fill = 0x20, outline = 0xFF},
	              ["throw"] = {color = 0xFFFF00, fill = 0x40, outline = 0xFF},
	          ["throwable"] = {color = 0xF0F0F0, fill = 0x20, outline = 0xFF},
}}}

The `color` numbers are [http://www.w3schools.com/html/html_colors.asp RGB values], and the `fill` and `outline` determine the opacity of the inside and outside of the box. `0xFF` is fully opaque and `0x00` is invisible.

The default colors are subject to change in future versions.

----
== Breakpoints ==
In its current form, the Lua engine can only get information about the game state by periodically reading from memory. Some kinds of boxes do not get written to RAM or are overwritten so soon that they cannot be read between frames. They can only be detected by monitoring when certain points in the code get executed. A tool that does this is called a breakpoint. For now the only way to use them and show those boxes is with the MAME-rr debugger.

Here's how to enable the debugger. Run MAME from the command line with the `-debug` switch:

{{{> mame sfa2 -debug -lua cps2-hitboxes.lua}}}

Or to avoid using the command line, create a .bat file that activates the debugger without specifying a game:

{{{mame -debug}}}

The debugger starts by halting execution of the game and the UI. Press F5 to release control. If the loaded game needs any BPs or WPs, the script will print them to the Lua console as a single line.

[http://img577.imageshack.us/img577/2598/bps.png]

Copy and paste the line over to the debugger console and hit enter. Now all supported box types will appear correctly.

[http://img43.imageshack.us/img43/3858/debugi.png]

The game may glitch up when the command is entered but this only happens once. Before quitting or unloading the ROM, enter `bpc` into the debugger console to clear any installed breaks, or else MAME will crash.

You can still use the scripts in FBA-rr or without the debugger, but they will not show the boxes that require BPs. Future versions of the emulators may make this procedure unnecessary.

----
= Supported games =

== sf2-hitboxes.lua ==
All of the Street Fighter II games.
||Parent ROM||Game||
||[http://maws.mameworld.info/maws/romset/sf2 sf2]||Street Fighter II: The World Warrior||
||[http://maws.mameworld.info/maws/romset/sf2ce sf2ce]||Street Fighter II': Champion Edition||
||[http://maws.mameworld.info/maws/romset/sf2hf sf2hf]||Street Fighter II': Hyper Fighting||
||[http://maws.mameworld.info/maws/romset/ssf2 ssf2]||Super Street Fighter II: The New Challengers||
||[http://maws.mameworld.info/maws/romset/ssf2t ssf2t]||Super Street Fighter II Turbo||
||[http://maws.mameworld.info/maws/romset/hsf2 hsf2]||Hyper Street Fighter 2: The Anniversary Edition||

[http://img853.imageshack.us/img853/918/sf2sf2.png]
[http://img827.imageshack.us/img827/9961/sf2sf2ceuc.png]
[http://img94.imageshack.us/img94/6789/sf2sf2hf.png]
[http://img17.imageshack.us/img17/8926/sf2ssf2.png]
[http://img854.imageshack.us/img854/4783/sf2ssf2t.png]
[http://img33.imageshack.us/img33/1657/sf2hsf2.png]

=== Notes ===
[http://img828.imageshack.us/img828/1993/colorssf2.png]

==== `weak` box ====
Attacks that hit a weakbox deal double damage. Weak boxes only appear in _Street Fighter II: World Warrior_ and in WW mode of _Hyper Street Fighter 2_. They are colored the same as throwboxes by default.

==== `air throwable` box ====
This box is susceptible to air throws but not ground throws. The opposite is true for the normal throwable box.

----
== marvel-hitboxes.lua ==
All of the Marvel/Versus games on the CPS-2 system.
||Parent ROM||Game||
||[http://maws.mameworld.info/maws/romset/xmcota xmcota]||X-Men: Children of the Atom||
||[http://maws.mameworld.info/maws/romset/msh msh]||Marvel Super Heroes||
||[http://maws.mameworld.info/maws/romset/xmvsf xmvsf]||X-Men Vs. Street Fighter||
||[http://maws.mameworld.info/maws/romset/mshvsf mshvsf]||Marvel Super Heroes Vs. Street Fighter||
||[http://maws.mameworld.info/maws/romset/mvsc mvsc]||Marvel Vs. Capcom: Clash of Super Heroes||

[http://img30.imageshack.us/img30/4595/marvelxmcota.png]
[http://img844.imageshack.us/img844/5650/marvelmsh.png]
[http://img217.imageshack.us/img217/3070/marvelxmvsf.png]
[http://img707.imageshack.us/img707/5739/marvelmshvsf.png]
[http://img153.imageshack.us/img153/3811/marvelmvsc.png]

=== Notes ===
==== Breakpoints ====
BPs are needed to show the exact frames when throws are active and when pushboxes are inactive. Without BPs, only the potential throw range is viewable, and pushboxes tend to flicker or not disappear when inactive.

[http://img23.imageshack.us/img23/4328/colorsmsh.png]

==== `potential throw` box ====
Even without breakpoints, it's possible to show where the box would appear if a throw were attempted. This box type is fully transparent (invisible) by default and can be shown by editing its opacity values. Showing it is not recommended since breakpoints can show the real throw attempts.

----
== cps2-hitboxes.lua ==
All of the remaining CPS-2 fighting games, including the Street Fighter Alpha and Darkstalkers series.
||Parent ROM||Game||
||[http://maws.mameworld.info/maws/romset/sfa sfa]||Street Fighter Alpha: Warriors' Dreams||
||[http://maws.mameworld.info/maws/romset/sfa2 sfa2]||Street Fighter Alpha 2||
||[http://maws.mameworld.info/maws/romset/sfz2al sfz2al]||Street Fighter Zero 2 Alpha||
||[http://maws.mameworld.info/maws/romset/sfa3 sfa3]||Street Fighter Alpha 3||
||[http://maws.mameworld.info/maws/romset/dstlk dstlk]`*`||Darkstalkers: The Night Warriors||
||[http://maws.mameworld.info/maws/romset/nwarr nwarr]||Night Warriors: Darkstalkers' Revenge||
||[http://maws.mameworld.info/maws/romset/vsav vsav]||Vampire Savior: The Lord of Vampire||
||[http://maws.mameworld.info/maws/romset/vhunt2 vhunt2]||Vampire Hunter 2: Darkstalkers Revenge||
||[http://maws.mameworld.info/maws/romset/vsav2 vsav2]||Vampire Savior 2: The Lord of Vampire||
||[http://maws.mameworld.info/maws/romset/ringdest ringdest]||Ring of Destruction: Slammasters II||
||[http://maws.mameworld.info/maws/romset/cybots cybots]||Cyberbots: Fullmetal Madness||
||[http://maws.mameworld.info/maws/romset/sgemf sgemf]||Super Gem Fighter Mini Mix||

[http://img694.imageshack.us/img694/4024/cps2sfa.png]
[http://img836.imageshack.us/img836/7163/cps2sfa2.png]
[http://img218.imageshack.us/img218/236/cps2sfz2al.png]
[http://img535.imageshack.us/img535/9103/cps2sfa3.png]
[http://img42.imageshack.us/img42/4465/cps2dstlk.png]
[http://img849.imageshack.us/img849/2909/cps2nwarr.png]
[http://img689.imageshack.us/img689/6391/cps2vsav.png]
[http://img109.imageshack.us/img109/5154/cps2vhunt2.png]
[http://img807.imageshack.us/img807/8093/cps2vsav2.png]
[http://img560.imageshack.us/img560/5288/cps2ringdest.png]
[http://img546.imageshack.us/img546/7540/cps2cybots.png]
[http://img696.imageshack.us/img696/5448/cps2sgemf.png]

=== Notes ===
==== Breakpoints ====
BPs are needed to show all throws in: sfa, sfa2, sfz2al, vsav, vhunt2, vsav2, cybots, and sgemf.

They are also needed in dstlk and nwarr to show air throws and to make ground throws be attempted at long range.

[http://img855.imageshack.us/img855/5071/colorssfa2.png]

==== `axis throw` box ====
Air throws in sfa, sfa2 & sfz2al, and special ranged throws in nwarr grab at the opponent's axis instead of a box. 

----
== beatemup-hitboxes.lua ==
Selected beat-em-up games on the CPS-2 system.
||Parent ROM||Game||
||[http://maws.mameworld.info/maws/romset/ffight ffight]||Final Fight||
||[http://maws.mameworld.info/maws/romset/dino dino]||Cadillacs and Dinosaurs||
||[http://maws.mameworld.info/maws/romset/punisher punisher]||The Punisher||
||[http://maws.mameworld.info/maws/romset/avsp avsp]||Alien vs. Predator||
||[http://maws.mameworld.info/maws/romset/ddtod ddtod]||Dungeons & Dragons: Tower of Doom||
||[http://maws.mameworld.info/maws/romset/ddsom ddsom]||Dungeons & Dragons: Shadow over Mystara||
||[http://maws.mameworld.info/maws/romset/batcir batcir]||Battle Circuit||

[http://img822.imageshack.us/img822/9829/beatemupffight.png]
[http://img819.imageshack.us/img819/744/beatemupdino.png]
[http://img708.imageshack.us/img708/2287/beatemuppunisher.png]
[http://img269.imageshack.us/img269/8210/beatemupavsp.png]
[http://img263.imageshack.us/img263/8329/beatemupddtod.png]
[http://img231.imageshack.us/img231/1513/beatemupddsom.png]
[http://img23.imageshack.us/img23/1985/beatemupbatcir.png]

----
== neogeo-hitboxes.lua ==
Selected fighting games on the !NeoGeo MVS system.
||Parent ROM||Game||
||[http://maws.mameworld.info/maws/romset/fatfury1 fatfury1]`*` ^1^ ^2^||Fatal Fury - King of Fighters||
||[http://maws.mameworld.info/maws/romset/fatfury2 fatfury2]`*` ^1^||Fatal Fury 2||
||[http://maws.mameworld.info/maws/romset/fatfursp fatfursp]`*` ^1^ ^2^||Fatal Fury Special||
||[http://maws.mameworld.info/maws/romset/fatfury3 fatfury3]`*` ^1^ ^2^||Fatal Fury 3 - Road to the Final Victory||
||[http://maws.mameworld.info/maws/romset/rbff1 rbff1]`*` ^1^ ^2^||Real Bout Fatal Fury||
||[http://maws.mameworld.info/maws/romset/kof94 kof94]`*`||The King of Fighters '94||
||[http://maws.mameworld.info/maws/romset/kof95 kof95]`*`||The King of Fighters '95||
||[http://maws.mameworld.info/maws/romset/kof96 kof96]||The King of Fighters '96||
||[http://maws.mameworld.info/maws/romset/kof97 kof97]||The King of Fighters '97||
||[http://maws.mameworld.info/maws/romset/kof98 kof98]||The King of Fighters '98 - The Slugfest||
||[http://maws.mameworld.info/maws/romset/kof99 kof99]||The King of Fighters '99 - Millennium Battle||
||[http://maws.mameworld.info/maws/romset/kof2000 kof2000]||The King of Fighters 2000||
||[http://maws.mameworld.info/maws/romset/kof2001 kof2001]||The King of Fighters 2001||
||[http://maws.mameworld.info/maws/romset/kof2002 kof2002]||The King of Fighters 2002||

The script has some problems with the Fatal Fury games:
 # The invincibility frames on some moves are not being shown.
 # Only works in MAME-rr, not in FBA-rr.

[http://img215.imageshack.us/img215/2107/neogeofatfury1.png]
[http://img17.imageshack.us/img17/6149/neogeofatfury2.png]
[http://img291.imageshack.us/img291/2624/neogeofatfursa.png]
[http://img405.imageshack.us/img405/1434/neogeofatfury3.png]
[http://img815.imageshack.us/img815/7351/neogeorbff1.png]
[http://img52.imageshack.us/img52/5269/neogeokof94.png]
[http://img600.imageshack.us/img600/9328/neogeokof95.png]
[http://img715.imageshack.us/img715/993/neogeokof96.png]
[http://img200.imageshack.us/img200/231/neogeokof97.png]
[http://img23.imageshack.us/img23/660/neogeokof98.png]
[http://img545.imageshack.us/img545/2005/neogeokof99a.png]
[http://img98.imageshack.us/img98/3276/neogeokof2000.png]
[http://img197.imageshack.us/img197/1767/neogeokof2001.png]
[http://img840.imageshack.us/img840/5589/neogeokof2002.png]

=== Notes ===
[http://img837.imageshack.us/img837/78/colorskof98.png]

==== `guard` box ====
Attacks that hit a guardbox will be blocked, either by manually blocking, by an autoguard move, or by a special counter move.

----
== sfiii3-hitboxes.lua ==
||[http://maws.mameworld.info/maws/romset/sfiii3 sfiii3]||Street Fighter III 3rd Strike: Fight for the Future||

This script was translated to Lua from the [http://code.google.com/p/mameserver/ mameserver] project. It's missing many features and may be inaccurate.

----
Errors or inconsistencies can be reported by leaving a comment to this page.